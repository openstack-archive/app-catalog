<h3 ng-if="type">{{type}}</h3>

<form name="artifactForm">
<table>

  <tr ng-repeat="i in formFields">
    <td><label for="{{i.name}}">{{i.name}}</label></td>

    <td ng-if="i.widget == 'input'"><input type="{{i.type}}" name="{{i.name}}" ng-model="artifact[i.name]" ng-required="i.required"></input></td>
    <td ng-if="i.widget == 'textarea'"><textarea name="{{i.name}}" ng-model="artifact[i.name]" ng-required="{{i.required}}"></textarea></td>
    <td ng-if="i.widget == 'select'"><select name="{{i.name}}" ng-model="artifact[i.name]" ng-required={{i.required}}>
      <option ng-repeat="opt in i.options">{{opt}}</option>
    </select></td>
    <td ng-if="i.type == 'multisel'"><select name="{{i.name}}" multiple ng-model="artifact[i.name]" ng-required={{i.required}}>
      <option ng-repeat="opt in i.options">{{opt}}</option>
    </select></td>
    <td ng-if="i.widget == 'blob'">
      <input type="file" name="{{i.name}}" id="blob_{{i.name}}"></input>
    </td>
  </tr>
  <tr><td><label>Metadata</label></td>
    <td>
      <table>
        <tr ng-repeat="(key, val) in artifact.metadata">
          <td>{{key}}</td>
          <td><input type="text" ng-model="artifact.metadata[key]" name="metadata-{{key}}"></input></td>
          <td><button ng-click="delMetadataEntry(key)">-</button></td>
        </tr>
        <tr><td><input type="text" name="md-new-key" ng-model="md_new_key"></input></td>
            <td colspan=2><button ng-click="addMetadataEntry()">Add new key</button></td>
        </tr>
      </table>
    </td>
  </tr>

</table>
</form>

{{blobs}}

<button ng-if="artifactForm.$valid && (artifactForm.$dirty || artifact.id)" ng-click="save(artifactForm)">Save</button>

<button ng-if="is_admin" ng-click="approve()">Approve</button>

<h2 ng-if="status">{{status}}</h2>
<div ng-if="error" class=xhr_error>
<p>{{error.status}} {{error.statusText}}</p>
<p>{{error.data.error.message}}</p>
</div>
